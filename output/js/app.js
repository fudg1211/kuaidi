(function(){var e=window,t={};t.Version="0.1.0",t.$=e.jQuery||e.Zepto||e.$;var n=function(e){return{}.toString.call(e)=="[object Function]"},r=function(e){return{}.toString.call(e)=="[object String]"},i=function(e){return{}.toString.call(e)=="[object Array]"},s=function(e){return{}.toString.call(e)=="[object Object]"},o=function(e){var t={},n=this;n.isArray(e)&&(t=[]);var r=function(e,t){if(n.isObject(e))for(k in e)e.hasOwnProperty(k)&&(n.isObject(e[k])?(t[k]={},arguments.callee(e[k],t[k])):n.isArray(e[k])?(t[k]=[],arguments.callee(e[k],t[k])):t[k]=e[k]);else if(n.isArray(e))for(k in e)n.isObject(e[k])?(t[k]={},arguments.callee(e[k],t[k])):n.isArray(e[k])?(t[k]=[],arguments.callee(e[k],t[k])):t[k]=e[k]}(e,t);return t},u=function(e,t,r,i){r||(r=[]),i||(i=[]);if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;var s=toString.call(e);if(s!=toString.call(t))return!1;switch(s){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var o=r.length;while(o--)if(r[o]==e)return i[o]==t;var a=e.constructor,f=t.constructor;if(a!==f&&!(n(a)&&a instanceof a&&n(f)&&f instanceof f))return!1;r.push(e),i.push(t);var l=0,c=!0;if(s=="[object Array]"){l=e.length,c=l==t.length;if(c)while(l--)if(!(c=u(e[l],t[l],r,i)))break}else{for(var h in e)if(e.hasOwnProperty(h)){l++;if(!(c=t.hasOwnProperty(h)&&u(e[h],t[h],r,i)))break}if(c){for(h in t)if(t.hasOwnProperty(h)&&!(l--))break;c=!l}}return r.pop(),i.pop(),c},a=[].slice,f=t.events={on:function(e,t,n){this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n||this}),this},once:function(e,t,n){var r=this,i=function(){r.off(e),t.apply(this,arguments)};this.on(e,i,n)},off:function(e){var t,n,i,s,o;if(!e)return this;r(e)?t=[e]:t=e;for(n=0,i=t.length;n<i;n++)e=t[n],delete this._events[e]},trigger:function(e){if(!this._events)return this;var t=a.call(arguments,1),n=this._events[e],r=this._events.all;return n&&l(n,t),r&&l(r,arguments),this}},l=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.context);return;case 1:while(++r<i)(n=e[r]).callback.call(n.context,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.context,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.context,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.context,t)}},c=t.Module=function(e,t){this.attributes={},this.default=!0,this.set(e,t)};c.prototype={get:function(e){return this.attributes[e]},del:function(e){delete this.attributes[e],this.trigger("del:"+e,this)},set:function(e,t,n){var r,i,o,a,f,l,c=[];s(e)?(i=e,n=t):(i={})[e]=t,n||(n={}),o=n.silent,a=n.del,l=this.attributes;for(r in i)t=i[r],(this.default||!u(l[r],t))&&c.push(r),a?this.del(r):l[r]=t;if(!o)for(var h=0;h<c.length;h++)this.trigger("change:"+c[h],this,l[c[h]],n);return this.default=!1,this}};var h=t.View=function(e){this.initializer.apply(this,arguments),this.init.apply(this,arguments),this.fn=this.constructor.prototype};h.prototype={proxy:function(e){return $.proxy(e,this)},include:function(e){$.extend(this.fn,e)},init:function(){},initializer:function(e){for(var t in e)this[t]=e[t];this.elements&&this.refreshElements(),this.events&&this.delegateEvents()},$:function(e){return this.el||(this.el=$(document.body)),$(e,this.el)},eventSplitter:/^(\w+)\s*(.*)$/,delegateEvents:function(){for(var e in this.events){var t=this.events[e],n=this.proxy(this[t]),r=function(e){return function(t){return e(this,t)}}(n),i=e.match(this.eventSplitter),s=i[1],o=i[2];o===""?this.el.bind(s,r):(o.search(/_rel$/)!==-1&&(o=this[o+"Selector"]),this.el.delegate(this[o]?this[o]:o,s,r))}},refreshElements:function(){var e=this;for(var t in this.elements){var n=this.elements[t];if(n.search(/_rel$/)!==-1){this[n+"Selector"]=t;var r=n.replace(/_rel$/,"");this[n]=function(t,n){return function(){return e[n]=e.$(t)}}(t,r)}else{var i=this.$(t);this[n]=i}}}};var p=function(e){var t=this,n=function(){t.apply(this,arguments)};return n.prototype=Object.create(this.prototype),$.extend(n.prototype,e),n};c.extend=h.extend=p,$.extend(c.prototype,f),window.FishMVC=t})(),define("lib/Fish",function(){}),function(){var rsplit=function(e,t){var n=t.exec(e),r=new Array,i,s,o;while(n!=null)i=n.index,s=t.lastIndex,i!=0&&(o=e.substring(0,i),r.push(e.substring(0,i)),e=e.slice(i)),r.push(n[0]),e=e.slice(n[0].length),n=t.exec(e);return!e==""&&r.push(e),r},chop=function(e){return e.substr(0,e.length-1)},extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};EJS=function(e){e=typeof e=="string"?{view:e}:e,this.set_options(e);if(e.precompiled){this.template={},this.template.process=e.precompiled,EJS.update(this.name,this);return}if(e.element){if(typeof e.element=="string"){var t=e.element;e.element=document.getElementById(e.element);if(e.element==null)throw t+"does not exist!"}e.element.value?this.text=e.element.value:this.text=e.element.innerHTML,this.name=e.element.id,this.type="["}else if(e.url){e.url=EJS.endExt(e.url,this.extMatch),this.name=this.name?this.name:e.url;var n=e.url,r=EJS.get(this.name,this.cache);if(r)return r;if(r==EJS.INVALID_PATH)return null;try{this.text=EJS.request(n+(this.cache?"":"?"+Math.random()))}catch(i){}if(this.text==null)throw{type:"EJS",message:"There is no template at "+n}}var r=new EJS.Compiler(this.text,this.type);r.compile(e,this.name),EJS.update(this.name,this),this.template=r},EJS.prototype={render:function(e,t){e=e||{},this._extra_helpers=t;var n=new EJS.Helpers(e,t||{});return this.template.process.call(e,e,n)},update:function(element,options){typeof element=="string"&&(element=document.getElementById(element));if(options==null)return _template=this,function(e){EJS.prototype.update.call(_template,element,e)};typeof options=="string"?(params={},params.url=options,_template=this,params.onComplete=function(request){var object=eval(request.responseText);EJS.prototype.update.call(_template,element,object)},EJS.ajax_request(params)):element.innerHTML=this.render(options)},out:function(){return this.template.out},set_options:function(e){this.type=e.type||EJS.type,this.cache=e.cache!=null?e.cache:EJS.cache,this.text=e.text||null,this.name=e.name||null,this.ext=e.ext||EJS.ext,this.extMatch=new RegExp(this.ext.replace(/\./,"."))}},EJS.endExt=function(e,t){return e?(t.lastIndex=0,e+(t.test(e)?"":this.ext)):null},EJS.Scanner=function(e,t,n){extend(this,{left_delimiter:t+"%",right_delimiter:"%"+n,double_left:t+"%%",double_right:"%%"+n,left_equal:t+"%=",left_comment:t+"%#"}),this.SplitRegexp=t=="["?/(\[%%)|(%%\])|(\[%=)|(\[%#)|(\[%)|(%\]\n)|(%\])|(\n)/:new RegExp("("+this.double_left+")|(%%"+this.double_right+")|("+this.left_equal+")|("+this.left_comment+")|("+this.left_delimiter+")|("+this.right_delimiter+"\n)|("+this.right_delimiter+")|(\n)"),this.source=e,this.stag=null,this.lines=0},EJS.Scanner.to_text=function(e){return e==null||e===undefined?"":e instanceof Date?e.toDateString():e.toString?e.toString():""},EJS.Scanner.prototype={scan:function(e){scanline=this.scanline,regex=this.SplitRegexp;if(!this.source==""){var t=rsplit(this.source,/\n/);for(var n=0;n<t.length;n++){var r=t[n];this.scanline(r,regex,e)}}},scanline:function(e,t,n){this.lines++;var r=rsplit(e,t);for(var i=0;i<r.length;i++){var s=r[i];if(s!=null)try{n(s,this)}catch(o){throw{type:"EJS.Scanner",line:this.lines}}}}},EJS.Buffer=function(e,t){this.line=new Array,this.script="",this.pre_cmd=e,this.post_cmd=t;for(var n=0;n<this.pre_cmd.length;n++)this.push(e[n])},EJS.Buffer.prototype={push:function(e){this.line.push(e)},cr:function(){this.script=this.script+this.line.join("; "),this.line=new Array,this.script=this.script+"\n"},close:function(){if(this.line.length>0){for(var e=0;e<this.post_cmd.length;e++)this.push(pre_cmd[e]);this.script=this.script+this.line.join("; "),line=null}}},EJS.Compiler=function(e,t){this.pre_cmd=["var ___ViewO = [];"],this.post_cmd=new Array,this.source=" ",e!=null&&(typeof e=="string"?(e=e.replace(/\r\n/g,"\n"),e=e.replace(/\r/g,"\n"),this.source=e):e.innerHTML&&(this.source=e.innerHTML),typeof this.source!="string"&&(this.source="")),t=t||"<";var n=">";switch(t){case"[":n="]";break;case"<":break;default:throw t+" is not a supported deliminator"}this.scanner=new EJS.Scanner(this.source,t,n),this.out=""},EJS.Compiler.prototype={compile:function(options,name){options=options||{},this.out="";var put_cmd="___ViewO.push(",insert_cmd=put_cmd,buff=new EJS.Buffer(this.pre_cmd,this.post_cmd),content="",clean=function(e){return e=e.replace(/\\/g,"\\\\"),e=e.replace(/\n/g,"\\n"),e=e.replace(/"/g,'\\"'),e};this.scanner.scan(function(e,t){if(t.stag==null)switch(e){case"\n":content+="\n",buff.push(put_cmd+'"'+clean(content)+'");'),buff.cr(),content="";break;case t.left_delimiter:case t.left_equal:case t.left_comment:t.stag=e,content.length>0&&buff.push(put_cmd+'"'+clean(content)+'")'),content="";break;case t.double_left:content+=t.left_delimiter;break;default:content+=e}else switch(e){case t.right_delimiter:switch(t.stag){case t.left_delimiter:content[content.length-1]=="\n"?(content=chop(content),buff.push(content),buff.cr()):buff.push(content);break;case t.left_equal:buff.push(insert_cmd+"(EJS.Scanner.to_text("+content+")))")}t.stag=null,content="";break;case t.double_right:content+=t.right_delimiter;break;default:content+=e}}),content.length>0&&buff.push(put_cmd+'"'+clean(content)+'")'),buff.close(),this.out=buff.script+";";var to_be_evaled="/*"+name+"*/this.process = function(_CONTEXT,_VIEW) { try { with(_VIEW) { with (_CONTEXT) {"+this.out+" return ___ViewO.join('');}}}catch(e){e.lineNumber=null;throw e;}};";try{eval(to_be_evaled)}catch(e){if(typeof JSLINT=="undefined")throw e;JSLINT(this.out);for(var i=0;i<JSLINT.errors.length;i++){var error=JSLINT.errors[i];if(error.reason!="Unnecessary semicolon."){error.line++;var e=new Error;throw e.lineNumber=error.line,e.message=error.reason,options.view&&(e.fileName=options.view),e}}}}},EJS.config=function(e){EJS.cache=e.cache!=null?e.cache:EJS.cache,EJS.type=e.type!=null?e.type:EJS.type,EJS.ext=e.ext!=null?e.ext:EJS.ext;var t=EJS.templates_directory||{};EJS.templates_directory=t,EJS.get=function(e,n){return n==0?null:t[e]?t[e]:null},EJS.update=function(e,n){if(e==null)return;t[e]=n},EJS.INVALID_PATH=-1},EJS.config({cache:!0,type:"<",ext:".ejs"}),EJS.Helpers=function(e,t){this._data=e,this._extras=t,extend(this,t)},EJS.Helpers.prototype={view:function(e,t,n){return n||(n=this._extras),t||(t=this._data),(new EJS(e)).render(t,n)},to_text:function(e,t){return e==null||e===undefined?t||"":e instanceof Date?e.toDateString():e.toString?e.toString().replace(/\n/g,"<br />").replace(/''/g,"'"):""}},EJS.newRequest=function(){var e=[function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new XMLHttpRequest},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var t=0;t<e.length;t++)try{var n=e[t]();if(n!=null)return n}catch(r){continue}},EJS.request=function(e){var t=new EJS.newRequest;t.open("GET",e,!1);try{t.send(null)}catch(n){return null}return t.status==404||t.status==2||t.status==0&&t.responseText==""?null:t.responseText},EJS.ajax_request=function(e){e.method=e.method?e.method:"GET";var t=new EJS.newRequest;t.onreadystatechange=function(){t.readyState==4&&(t.status==200?e.onComplete(t):e.onComplete(t))},t.open(e.method,e.url),t.send(null)}}(),EJS.Helpers.prototype.date_tag=function(e,t,n){t instanceof Date||(t=new Date);var r=["January","February","March","April","May","June","July","August","September","October","November","December"],i=[],s=[],o=[],u=t.getFullYear(),a=t.getMonth(),f=t.getDate();for(var l=u-15;l<u+15;l++)i.push({value:l,text:l});for(var c=0;c<12;c++)s.push({value:c,text:r[c]});for(var h=0;h<31;h++)o.push({value:h+1,text:h+1});var p=this.select_tag(e+"[year]",u,i,{id:e+"[year]"}),d=this.select_tag(e+"[month]",a,s,{id:e+"[month]"}),v=this.select_tag(e+"[day]",f,o,{id:e+"[day]"});return p+d+v},EJS.Helpers.prototype.form_tag=function(e,t){return t=t||{},t.action=e,t.multipart==1&&(t.method="post",t.enctype="multipart/form-data"),this.start_tag_for("form",t)},EJS.Helpers.prototype.form_tag_end=function(){return this.tag_end("form")},EJS.Helpers.prototype.hidden_field_tag=function(e,t,n){return this.input_field_tag(e,t,"hidden",n)},EJS.Helpers.prototype.input_field_tag=function(e,t,n,r){return r=r||{},r.id=r.id||e,r.value=t||"",r.type=n||"text",r.name=e,this.single_tag_for("input",r)},EJS.Helpers.prototype.is_current_page=function(e){return window.location.href==e||window.location.pathname==e?!0:!1},EJS.Helpers.prototype.link_to=function(e,t,n){if(!e)var e="null";if(!n)var n={};return n.confirm&&(n.onclick=' var ret_confirm = confirm("'+n.confirm+'"); if(!ret_confirm){ return false;} ',n.confirm=null),n.href=t,this.start_tag_for("a",n)+e+this.tag_end("a")},EJS.Helpers.prototype.submit_link_to=function(e,t,n){if(!e)var e="null";if(!n)var n={};return n.onclick=n.onclick||"",n.confirm&&(n.onclick=' var ret_confirm = confirm("'+n.confirm+'"); if(!ret_confirm){ return false;} ',n.confirm=null),n.value=e,n.type="submit",n.onclick=n.onclick+(t?this.url_for(t):"")+"return false;",this.start_tag_for("input",n)},EJS.Helpers.prototype.link_to_if=function(e,t,n,r,i,s){return this.link_to_unless(e==0,t,n,r,i,s)},EJS.Helpers.prototype.link_to_unless=function(e,t,n,r,i){return r=r||{},e?i&&typeof i=="function"?i(t,n,r,i):t:this.link_to(t,n,r)},EJS.Helpers.prototype.link_to_unless_current=function(e,t,n,r){return n=n||{},this.link_to_unless(this.is_current_page(t),e,t,n,r)},EJS.Helpers.prototype.password_field_tag=function(e,t,n){return this.input_field_tag(e,t,"password",n)},EJS.Helpers.prototype.select_tag=function(e,t,n,r){r=r||{},r.id=r.id||e,r.value=t,r.name=e;var i="";i+=this.start_tag_for("select",r);for(var s=0;s<n.length;s++){var o=n[s],u={value:o.value};o.value==t&&(u.selected="selected"),i+=this.start_tag_for("option",u)+o.text+this.tag_end("option")}return i+=this.tag_end("select"),i},EJS.Helpers.prototype.single_tag_for=function(e,t){return this.tag(e,t,"/>")},EJS.Helpers.prototype.start_tag_for=function(e,t){return this.tag(e,t)},EJS.Helpers.prototype.submit_tag=function(e,t){return t=t||{},t.type=t.type||"submit",t.value=e||"Submit",this.single_tag_for("input",t)},EJS.Helpers.prototype.tag=function(e,t,n){if(!n)var n=">";var r=" ";for(var i in t){if(t[i]!=null)var s=t[i].toString();else var s="";i=="Class"&&(i="class"),s.indexOf("'")!=-1?r+=i+'="'+s+'" ':r+=i+"='"+s+"' "}return"<"+e+r+n},EJS.Helpers.prototype.tag_end=function(e){return"</"+e+">"},EJS.Helpers.prototype.text_area_tag=function(e,t,n){return n=n||{},n.id=n.id||e,n.name=n.name||e,t=t||"",n.size&&(n.cols=n.size.split("x")[0],n.rows=n.size.split("x")[1],delete n.size),n.cols=n.cols||50,n.rows=n.rows||4,this.start_tag_for("textarea",n)+t+this.tag_end("textarea")},EJS.Helpers.prototype.text_tag=EJS.Helpers.prototype.text_area_tag,EJS.Helpers.prototype.text_field_tag=function(e,t,n){return this.input_field_tag(e,t,"text",n)},EJS.Helpers.prototype.url_for=function(e){return'window.location="'+e+'";'},EJS.Helpers.prototype.img_tag=function(e,t,n){return n=n||{},n.src=e,n.alt=t,this.single_tag_for("img",n)},define("lib/ejs_production",function(){});var JSON;JSON||(JSON={}),function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("lib/json2",function(){}),function(){var e=function(e){var t=e.className,n=e.funs,r=e.content||"",i=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div"),u=document.createElement("div");i.className="cover",s.className="dialog",u.className="clear",t&&$(i).addClass(t),o.className="dialogInner",o.innerHTML=r,s.appendChild(o),i.appendChild(s),$("body").append(i).append(u),i.style.visibility="hidden";var a=document.body.scrollTop,f=s.offsetHeight,l=a+window.innerHeight/2-f/2-10,c=document.body.scrollHeight;l<20&&(l=20);var h=0;(function(){h++,f=s.offsetHeight,!f&&h<20?setTimeout(arguments.callee(),50):(l=a+window.innerHeight/2-f/2-10,l<=a&&(l=a),s.style.top=l.toString()+"px",s.style.opacity=1,i.style.visibility="visible")})();var p=0;(function(){var e=u.offsetTop,t=e>c?e:c;i.style.height=t.toString()+"px",p++,e<c&&p<20?setTimeout(arguments.callee,50):$(u).remove()})();var d=$(s).find(".J-dialogButton");return n&&n.length&&d.each(function(e,t){n[e]&&$(this).click(function(){n[e]()})}),$(s).find(".J-dialogClose").click(function(){return $(i).remove(),$(u).remove(),e.closeBack&&e.closeBack(),!1}),i};window.dialog=e}(),define("lib/dialog",function(){}),define("app/global/configs",[],function(){return{}}),define("app/global/storage",[],function(){var e={}.toString,t=window.$;return{local:{set:function(e,t){localStorage.setItem(e,t)},get:function(e){return localStorage.getItem(e)},remove:function(e){return localStorage.removeItem(e)},removeAll:function(e){var t=localStorage;for(e in t)this.remove(e)}},session:{set:function(e,t){sessionStorage.setItem(e,t)},get:function(e){return sessionStorage.getItem(e)},remove:function(e){sessionStorage.removeItem(e)},removeAll:function(e){var t=sessionStorage;for(e in t)this.remove(e)}},cookie:{setSession:function(e,t,n){var r=this._getCookieValue(e,t,n);document.cookie=r},setLocal:function(e,t,n){var r=this._getCookieValue(e,t,n)+this._getExpires(1e3);document.cookie=r},setLocalMaxSeconds:function(e,t,n,r){var i=(new Date).getTime()+n*1e3;this.pointTime(e.trim(),t,i,r)},pointTime:function(e,t,n,r){var i=new Date(n),s;s=this._getCookieValue(e,t,r)+";expires="+i.toGMTString()+this._getPath(r),document.cookie=s},pointMidNight:function(e,t,n,r){var i=new Date;n=parseInt(n)||1;var s=i.getFullYear()+"-"+i.getMonth()+"-"+(i.getDate()+n);this.pointTime(e,t,s,r)},get:function(e){var t=null,n=e+"=";return document.cookie.length>0&&(offset=document.cookie.indexOf(n),offset!=-1&&(offset+=n.length,end=document.cookie.indexOf(";",offset),end==-1&&(end=document.cookie.length),t=unescape(document.cookie.substring(offset,end)))),t},remove:function(e){this.setSession(e,"",-1)},removeAll:function(){var e=document.cookie,t=e.split(";"),n;for(var r=0;r<t.length;r++)t[r]&&(n=t[r].split("="),n[0]&&this.remove(n[0].trim()))},_getExpires:function(e){if(e){var t=new Date;return t.setDate(t.getDate()+e),";expires="+t.toGMTString()}return undefind},_getCookieValue:function(e,t,n){return e.trim()+"="+encodeURIComponent(t)+this._getPath(n)},_getPath:function(e){return e?";path="+e:""}}}}),define("app/global/hack",[],function(){var e={}.toString,t=window.navigator.userAgent,n=window.location.href,r=window.$,i=r("#body");/android\s*2\.3\.\d/i.test(t)&&(/android236/i.test(n)||(n+="&android236",window.location.href=n)),/ipad/i.test(t)&&r(".fenxiangPYQ").hide()}),define("app/global/regular",[],function(){return{isPhoneNum:function(e){return/^1\d{10}$/.test(e)?!0:!1},isIpad:function(){return/ipad/i.test(window.navigator.userAgent)?!0:!1},isIphone:function(){return/iphone/i.test(window.navigator.userAgent)?!0:!1},isIos:function(){return this.isIpad()&&this.isIphone()},isAndroid:function(){return/android/i.test(window.navigator.userAgent)?!0:!1},isMobile:function(){return this.isIos()&&this.isAndroid()}}}),define("app/global/common",["./configs","./storage","./hack","./regular"],function(e,t,n,r){var i={}.toString,s=window.$,o=window.navigator.userAgent;return window.com=common={isFunction:function(e){return i.call(e)==="[object Function]"},isString:function(e){return i.call(e)==="[object String]"},isNumber:function(e){return i.call(e)==="[object Number]"},isBoolean:function(e){return i.call(e)==="[object Boolean]"},isNull:function(e){return e===null},isArray:function(e){return i.call(e)==="[object Array]"},isObject:function(e){return i.call(e)==="[object Object]"},isBaseType:function(e){return!this.isArray(e)&&!this.isObject(e)},isUrl:function(e){return/^http:\/\//i.test(e)},isgImgUrl:function(e){return e=e.trim(),/\.(jpeg|jpg|gif|png|bmp)(\?.*)*$/i.test(e)},isJsonP:function(e){return/^\w+\([\[\{].*[\}\]]\)$/.test(e)},isJson:function(e){return/^[\{\[].*[\}\]]$/.test(e)},testSpeed:function(e){var t=(new Date).getTime();this._timeNode&&console.log(e+":"+(t-this._timeNode)),this._timeNode=(new Date).getTime()},getType:function(e){var t=i.call(e),n=t.match(/\s(\w+)\]$/i);return t=n[1].toLowerCase().trim(),t},getObjectLength:function(e){var t=0;for(k in e)t++;return t},storage:t,configs:e,regular:r,render:function(e,t,n){n=n?n:e+"Dest",(new EJS({element:e})).update(n,{md:t})},getRender:function(e,t){return(new EJS({url:e})).render({md:t})},dialog:function(e){if(!e.content){var t=e.url||"tpl/dialog";delete e.url,e.content=this.getRender(t,e)}return dialog(e)},alert:function(e){return e||(e={}),e.content||(e.url=e.url||"tpl/alert"),e.className?e.className+=" alertDialog":e.className="alertDialog",this.dialog(e)},loading:{show:function(){com.testSpeed("n");var e='<div class="loading"></div>';s("body").append(e)},hide:function(){setTimeout(function(){s(".loading").remove()},300)}},ajax:function(e){var t=this;e.hideLoading||this.loading.show();var n={type:"POST",dataType:"json",url:t.configs.host,async:!1,data:"",success:function(e){},error:function(){t.alert("网络异常"),initData.onDataError=!0},complete:function(e){t.loading.hide()}};this.mix(n,e),s.ajax(n)},mix:function(e,t){var n;for(n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)&&t[n]&&(e[n]=t[n])},clon:function(e){var t={},n=this;n.isArray(e)&&(t=[]);var r=function(e,t){if(n.isObject(e))for(k in e)e.hasOwnProperty(k)&&(n.isObject(e[k])?(t[k]={},arguments.callee(e[k],t[k])):n.isArray(e[k])?(t[k]=[],arguments.callee(e[k],t[k])):t[k]=e[k]);else if(n.isArray(e))for(k in e)n.isObject(e[k])?(t[k]={},arguments.callee(e[k],t[k])):n.isArray(e[k])?(t[k]=[],arguments.callee(e[k],t[k])):t[k]=e[k]}(e,t);return t},gather:{},queryArray:[],query:function(e){if(!e)return!1;if(this.queryArray.length)return this.queryArray[e];var t=window.location.href;t=t.replace(/#[^&]*$/,"");var n=/\?(.+)/,r=t.match(n);if(r&&r[1]){var i=r[1].split("&");for(a in i){var s=i[a].split("="),o=s[0],u=s[1];this.queryArray[o]=u}return this.queryArray[e]}return""}},common}),define("app/global/data",[],function(){return{getGuoneiCompany:function(){return[["a01","shunfeng","顺丰速递",0,!1,!1],["a02","yuantong","圆通快递",0,!1,!1],["a03","shentong","申通快递",0,!1,!1],["a04","ems","EMS特快专递",0,!1,!1],["a05","huitongkuaidi","汇通快递",0,!1,!1],["a06","zhongtong","中通快递",0,!1,!1],["a07","yunda","韵达快递",0,!1,!1],["a08","tiantian","天天快递",0,!1,!1],["a08","quanfengkuaidi","全峰快递",0,!1,!1],["a09","quanyikuaidi","全一快递",0,!1,!1],["a10","rufengda","如风达",0,!1,!1],["a11","emsguoji","EMS国际",0,!1,!1],["a12","zhaijisong","宅急送",0,!1,!1],["a13","debangwuliu","德邦物流",0,!1,!1],["b01","fedex","FedEx",0,!1,!1],["b02","usps","USPS",0,!1,!1],["b03","ups","UPS",0,!1,!1],["b04","dhl_us","DHL(美国)",0,!1,!1],["b05","dhl_de","DHL(德国)",0,!1,!1],["b06","TNT","TNT",0,!1,!1]]},search:function(e,t,n){var r="http://www.kuaidi100.com/query?type="+e+"&postid="+t.toString();com.ajax({type:"get",url:r,success:function(e){e&&n?n(e):com.alert({msg:"网络错误，请待会再试。"})}})}}}),define("app/localData",["./global/common","./global/data"],function(e,t){return{getAll:function(){var t=e.storage.local.get("localData");if(t){t=JSON.parse(t);var n=function(e,t){return t.createTime-e.createTime},r=function(e,t){return parseInt(t.data.ischeck)-parseInt(e.data.ischeck)};return t.sort(n),t.sort(r),t}return!1},getById:function(e){var t=this.getAll();for(var n=0;n<t.length;n++)if(t[n].id===e)return t[n];return!1},add:function(e){if(!this.getById(e.id)){var t=this.getAll();if(!t||!t.length)t=[];t.push(e),this.save(t)}return t},delById:function(e){var t=this.getAll();for(var n=0;n<t.length;n++)if(t[n].id===e)return t.splice(n,1),this.save(t),!0},checkByIdAndCom:function(e,t){var n=this.getAll();for(var r=0;r<n.length;r++)if(n[r].id===e&&n[r].data.com===t)return!0},updateById:function(e,t){var n=this.getAll();for(var r=0;r<n.length;r++)if(n[r].id===e)return n[r]=t,this.save(n),!0},save:function(t){var n=JSON.stringify(t);e.storage.local.set("localData",n)}}}),define("app/index",["./global/common","./global/data","./localData"],function(e,t,n){var r=FishMVC.View.extend({init:function(){this.autoRefreshData()},elements:{"#addIco":"addIco","#setIco":"setIco_rel",".selecteCompanys":"selecteCompanys_rel",".companysSelected":"companysSelected_rel","#saveSetCompanys":"saveSetCompanys_rel",".company":"company_rel","#companySelected":"companySelected_rel","#search":"search_rel","#addInput":"addInput_rel",".orderInfo":"orderInfo_rel",".showOrderDetail":"showOrderDetail_rel",".delNu":"delNu_rel",".orderDescDetailContainer":"orderDescDetailContainer_rel","#orderContainer":"orderContainer_rel",".refreshNu":"refreshNu_rel"},events:{"click addIco":"addNu","click setIco_rel":"setCompany","click selecteCompanys_rel":"selecteCompanys","click saveSetCompanys_rel":"saveSetCompanys","click company_rel":"selectCompany","click search_rel":"search","click orderInfo_rel":"showOrderInfo","click delNu_rel":"delNu","click orderDescDetailContainer_rel":"orderDescDetailContainer","click refreshNu_rel":"refreshNu"},autoRefreshData:function(){var e=n.getAll();for(var t=0;t<e.length;t++)this.searchBack(e[t].data,1);var r,i=this;setTimeout(function(){for(t=0;t<e.length;t++){r=e[t].data;if(parseInt(r.ischeck)||e[t].time+9e5>(new Date).getTime())continue;i.searchQuery(r.com,r.nu,1)}},100)},addNu:function(){var n=e.clon(t.getGuoneiCompany()),r=e.storage.local.get("localCompanys"),i=[],s=JSON.parse(e.storage.local.get("lastNuAndCompany"))||["",!1];if(r){r=JSON.parse(r);for(var o=0;o<r.length;o++)for(var u=0;u<n.length;u++)if(n[u][0]===r[o]){i.push(n[u]);break}}for(o=0;o<i.length;o++)i[o][1]===s[1]&&(i[o][5]="companySelected");var a={url:"tpl/addNu",className:"addNu",funs:[function(){}],data:i,last:s};this._addNuPannel=e.dialog(a)},getCompanyById:function(n){var r=t.getGuoneiCompany(),i;for(var s=0;s<r.length;s++)if(r[s][0]===n){i=r[s];break}return i&&(i=e.clon(i)),i},getCompanyByEnName:function(n){var r=t.getGuoneiCompany(),i;for(var s=0;s<r.length;s++)if(r[s][1]===n){i=r[s];break}return i&&(i=e.clon(i)),i},setCompany:function(n){$(n).removeClass("setIco_tip");var r=e.clon(t.getGuoneiCompany()),i=e.storage.local.get("localCompanys");i&&(i=JSON.parse(i));if(i)for(var s=0;s<i.length;s++)for(var o=0;o<r.length;o++)if(r[o][0]===i[s]){r[o][4]=!0;break}var u={url:"tpl/setNu",className:"addNu",funs:[function(){}],data:r};this._setCompanyPannel=e.dialog(u)},selecteCompanys:function(e){e=$(e),e.hasClass("companysSelected")?e.removeClass("companysSelected"):e.addClass("companysSelected")},saveSetCompanys:function(){this.companysSelected_rel();var t=[];this.companysSelected.each(function(){var e=$(this).attr("id");t.push(e)});if(!t.length)return e.alert({msg:"最少选择一个公司"}),!1;e.storage.local.set("localCompanys",JSON.stringify(t)),this._setCompanyPannel.remove(),this._setCompanyPannel=null,this._addNuPannel.remove(),this._addNuPannel=null,this.addNu()},selectCompany:function(e){e=$(e),$(".companySelected").removeClass("companySelected").removeAttr("id","companySelected"),e.addClass("companySelected").attr("id","companySelected")},search:function(){var t=this.companySelected_rel(),r=this.addInput_rel(),i=t.attr("companyId"),s=this,o,u=r.val();if(!u)return r.attr("placeholder","请输入运单号").focus(),!1;i||e.alert({msg:"请选择快递公司"});var a=this.getCompanyById(i);a&&a.length&&(o=a[1]);if(n.checkByIdAndCom(u,o)){e.alert({msg:"已经有该运单"});return}this.searchQuery(o,u),e.storage.local.set("lastNuAndCompany",JSON.stringify([u,o]))},searchQuery:function(n,r,i){var s=this;e.testSpeed("a1"),t.search(n,r,function(e){e.nu||(e.nu=r),s.searchBack(e,i)&&s._addNuPannel&&s._addNuPannel.remove()})},searchBack:function(t,r){var i=n.getById(t.nu);if(i&&i.length)t.data||(t=e.clon(i.data));else{if(t.status!=="200"&&t.status!=="400")return e.alert({msg:t.message,className:"searchBackDialog"}),!1;if(t.status==="400"&&!r)return e.alert({msg:"暂无该单号最新信息，请稍后再试！",className:"searchBackDialog"}),!1}t.comDetail=this.getCompanyByEnName(t.com);if(i&&r){var s=parseInt(((new Date).getTime()-parseInt(i.time))/6e4);s<1?t.timeStr="刚刚更新":t.timeStr=""+s.toString()+"分钟前"}else t.timeStr="刚刚更新";var o=e.getRender("tpl/nuList",t),u=$("#nu_"+t.nu.toString()+"_"+t.com);t.nu&&u&&u.length?u.html($(o).children()):this.orderContainer_rel().prepend(o);var a=(new Date).getTime();return i?(r&&(a=i.time),n.updateById(t.nu,{id:t.nu,data:t,time:a,createTime:i.createTime})):n.add({id:t.nu,data:t,time:a,createTime:a}),!0},showOrderInfo:function(e){var t=this;setTimeout(function(){if(t._delNu||t._orderDescDetailContainer||t._refreshNu)return setTimeout(function(){t._delNu=!1,t._refreshNu=!1,t._orderDescDetailContainer=!1},100),!1;e=$(e);var n=e.hasClass("showOrderDetail");t.showOrderDetail_rel().removeClass("showOrderDetail"),n||e.addClass("showOrderDetail")},10)},delNu:function(t){var n=this;this._delNu=!0;var r={msg:"确定要删除吗？",buttons:[["确定","J-dialogClose"],["取消","J-dialogClose"]],funs:[function(){n.delSubmit(t)}]};return e.dialog(r),!1},delSubmit:function(e){e=$(e).parent();var t=e.attr("nu");n.delById(t)&&e.remove()},refreshNu:function(t){this._refreshNu=!0,e.testSpeed("1"),t=$(t).parent();var r=t.attr("nu"),i=n.getById(r),s=i.data.ischeck,o=i.data.com;if(i.time&&parseInt(i.time)+6e4>(new Date).getTime())return!1;e.testSpeed("a");if(parseInt(s))return!1;this.searchQuery(o,r)},orderDescDetailContainer:function(){return this._orderDescDetailContainer=!0,!1}}),i=new r,s=FishMVC.Module.extend(),o=new s;o.on("change:localData",function(){})});var initData={dir:"/chrome/kuaidi/js/"};requirejs.config({baseUrl:"js",urlArgs:"v=123"}),requirejs(["./lib/Fish","./lib/ejs_production","./lib/json2","./lib/dialog","./app/index"],function(){}),define("app",function(){});